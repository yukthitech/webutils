<directives>
	<directive name="ykField">
		<content>
			<set-var name="_idAttr" expr="context.attributes.id ? context.attributes.id : ''"/>
			<set-var name="_typeAttr" expr="context.attributes.type ? context.attributes.type : ''"/>
			<set-var name="_modelAttr" expr="context.attributes.model ? context.attributes.model : ''"/>
			<set-var name="_nameAttr" expr="context.attributes.name ? context.attributes.name : (context.attributes.model ? context.attributes.model : '')"/>
			
			<div class="form-group">
				<label for="${_nameAttr}" class="col-md-4 control-label">${attributes.label}</label>
				<div class="col-md-8" style="padding-left: 0.5em;">
					<input type="${_typeAttr}" class="form-control" 
						id="${_idAttr}" name="${_nameAttr}" 
						placeholder="${attributes.label}" ng-model="${_modelAttr}"/>
				</div>
			</div>
		</content>
	</directive>
	
	<directive name="ykImageSlider" required-attr="id, dataattr, width, height">
		<content>
			<set-var name="_idAttr" expr="context.attributes.id"/>
			<set-var name="_dataAttr" expr="context.attributes.dataattr"/>
			
			<div id="${_idAttr}" style="width: ${attributes.width};height: ${attributes.height};">
				<div style="width: ${attributes.width};height: ${attributes.height}; position: absolute;">
					
					<div ng-repeat="slideImage in ${_dataAttr}" class="slideImage {{$first ? 'slideImageActive' : 'slideImageInactive'}}"
						style="width: 100%; height: ${attributes.height}; background-image: url('{{slideImage.imagePath}}'); background-repeat: no-repeat; background-size: 100% 100%;">
						<div ng-bind-html="slideImage.caption | unsafe">
					    </div>
					</div>
					
					<div class="slideImageNavBut leftNav" style="left: 0px;">
						<span class="glyphicon glyphicon-chevron-left" style="font-size: 2em;"></span>
					</div>
					
					<div class="slideImageNavBut rightNav" style="right: 0px;">
					 	<span class="glyphicon glyphicon-chevron-right" style="font-size: 2em;"></span>
					</div>
				</div>
			</div>
		</content>
		
		<post-script>
			$.slideImages(context.attr("id"));
		</post-script>
	</directive>

	<directive name="ykDropDown" required-attr="id, icon">
		<content>
			<set-var name="_label" expr="context.flexAttr('label')"/>
			<set-var name="_header" expr="context.flexAttr('header')"/>
			<set-var name="_footer" expr="context.flexAttr('footer')"/>
			<set-var name="_content" expr="context.element.find('content').html()"/>
			
			<div class="dropdown" style="display: inline;">
				<a id="${attributes.id}" style="text-decoration: none;" data-target="#" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
					<i class="glyphicon appIcon ${attributes.icon}" style="color: ${attr('icon-color','')};font-weight: bold;" aria-hidden="true"></i>
					${_label}
				</a>
				
				<div id="${attributes.id}-dropdown" class="dropdown-menu dropdown-menu-right" aria-labelledby="${attributes.id}">
					<if test="context._header.length > 0">
						<div class="yk-dropdown-header">
							${_header}
						</div>
					</if>
					${_content}
					<if test="context._footer.length > 0">
						<div class="yk-dropdown-footer">
							${_footer}
						</div>
					</if>
				</div>
			</div>

		</content>
	</directive>

	<directive name="ykTabs">
		<content>
			<set-var name="_tabs" expr="context.element.find('tab')"/>
			
			<set-var name="_footer" expr="context.flexAttr('footer')"/>
			<set-var name="_content" expr="context.element.find('content').html()"/>
			<set-var name="_showContent" expr="context.attr('show-content') ? context.attr('show-content') : 'true'"/>
			
			<div>
				<!-- Nav tabs -->
				<ul class="nav nav-tabs" role="tablist" style="min-width: 1000em;">
					<for-each data="${_tabs}" loop-var="tab" index-var="tabIdx">
						<set-var name="_tab" expr="$(context.tab)"/>
						<set-var name="_tabId" expr="context._tab.attr('id')"/>
						<set-var name="_tabActive" expr="context.tabIdx == 0 ? 'active' : ''"/>
						<set-var name="_tabShowExpr" expr="context.attr('ng-show', null, context._tab) ? context.attr('ng-show', null, context._tab) : 'true'"/>
						<set-var name="_forRole" expr="context.attr('yk-for-role', null, context._tab) ? context.attr('yk-for-role', null, context._tab) : ''"/>
						
						<li role="presentation" class="${_tabActive}" ng-show="${_tabShowExpr}" yk-for-role="${_forRole}" style="cursor: pointer;">
							<a id="${_tabId}_tab" ui-sref="${_tab.attr('state')}" onfocus="blur()" data-target="#${_tabId}" data-toggle="tab">
								<if test="context.attr('icon', null, context._tab)">
									<i class="glyphicon ${_tab.attr('icon')}" 
										style="color: ${attr('icon-color', '', context._tab)};font-weight: bold;" aria-hidden="true"></i>
								</if>
								${_tab.attr('label')}
							</a>
						</li>
					</for-each>
				</ul>
			
				<!-- Tab panes -->
				<if test="context._showContent == 'true'">
					<div class="tab-content">
						<for-each data="${_tabs}" loop-var="tab" index-var="tabIdx">
							<set-var name="_tab" expr="$(context.tab)"/>
							<set-var name="_tabActive" expr="context.tabIdx == 0 ? 'active' : ''"/>
							<set-var name="_tabContent" expr="context._tab.html()"/>
							<set-var name="_tabShowExpr" expr="context.attr('ng-show', null, context._tab) ? context.attr('ng-show', null, context._tab) : 'true'"/>
							<set-var name="_forRole" expr="context.attr('yk-for-role', null, context._tab) ? context.attr('yk-for-role', null, context._tab) : ''"/>
							
							<div role="tabpanel" class="tab-pane ${_tabActive}" id="${_tab.attr('id')}" ui-view="${_tab.attr('view')}" style="padding: 0.5em;" ng-show="${_tabShowExpr}"  yk-for-role="${_forRole}">
								${_tabContent}
							</div>
	
						</for-each>
					</div>
				</if>
			</div>
		</content>
		
		<pre-compile-script>
			var links = context.$result.find("a[ui-sref='undefined']");
			
			links.each(function(){
				$(this).removeAttr("ui-sref");
			});
		</pre-compile-script>
	</directive>

	<directive name="ykVerticalTabs" required-attr="id, height">
		<content>
			<set-var name="_tabs" expr="context.element.find('tab')"/>
			
			<div style="width: 100%;" id="${attr('id')}">
				<table style="width: 100%;" class="vtabMainContainer">
					<tr>
						<td style="width: 1px;" class="vtabContainer">
							<table style="width: 100%">
								
								<for-each data="${_tabs}" loop-var="tab" index-var="tabIdx">
									<set-var name="_tab" expr="$(context.tab)"/>
									<set-var name="_tabId" expr="context._tab.attr('id')"/>
									<set-var name="_tabActive" expr="context.tabIdx == 0 ? 'vtab-active' : 'vtab'"/>
									<set-var name="_forRole" expr="context.attr('yk-for-role', null, context._tab) ? context.attr('yk-for-role', null, context._tab) : ''"/>
									
									<tr>
										<td id="${_tabId}_tab" class="${_tabActive}" html-src="${_tab.attr('html-src')}">
											<if test="context.attr('icon', null, context._tab)">
												<i class="glyphicon ${_tab.attr('icon')}" 
													style="color: ${attr('icon-color', '', context._tab)};font-weight: bold;" aria-hidden="true"></i>
											</if>
											<span yk-hide-from="sm">${_tab.attr('label')}</span>
										</td>
									</tr>
								</for-each>
							</table>
						</td>
						<td class="vtabContentContainer" >
							<div class="vtabContent" style="overflow: auto; height: ${attr('height')}; padding: 0.5em; padding-left: 1em;">
							</div>
						</td>
					</tr>
				</table>
			</div>
		</content>

		<post-script>
			$.verticalTabs(context.$result, context.$compile, context.$scope);
		</post-script>
	</directive>

	<directive name="ykNavTree">
		<content>
			<exe-script>
				context.executeTemplate({
					"parent" : context.element
				}, "processTreeItems");
			</exe-script>
			 	
			<div class="navbar-text pull-right"></div>
		</content>
	</directive>
	
	<template name="processTreeItems">
		<set-var name="_items" expr="context.parent.children('tree-item')"/>
		
		<if test="context._items.length &lt;= 0">
			<return/>
		</if>
		
		<ul class="yk-nav-list">
			<for-each data="${_items}" loop-var="item" index-var="itemIdx">
				<set-var name="_item" expr="$(context.item)"/>
				
				<li role="presentation">
					<a id="${_item.attr('id')}" ui-sref="${_item.attr('state')}">
						<if test="context._item.attr('icon')">
							<i class="glyphicon appIcon ${_item.attr('icon')}" 
								style="color: ${_item.attr('icon-color')};font-weight: bold; font-size: 1.1em; margin-right: 0.1em;" 
								aria-hidden="true"></i>
						</if>
						
						${_item.attr('label')}
					</a>
		
					<exe-script>
						context.executeTemplate({
							"parent" : context._item
						}, "processTreeItems");
					</exe-script>
				</li>
			</for-each>
		</ul>
	</template>

	<directive name="ykSearchQuery" required-attr="id, name, title">
		<pre-process>
			context.executeAsyncSteps({"context": context, "processTemplate": processTemplate}, [
			
				//invokes action to fetch search query definition			
				function(callback) {
					var name = this.context.attr("name");
					
					//send the callback to invoke action, so that next method is called when
						// data is recieved from server
					context.modelDefService.getSearchQueryDef(name, callback);
				},
			
				//validates and sets the query def on context and proceeds with template processing	
				function(callback, searchQueryRes, responseConfig) {
					var name = this.context.attr("name");
					
					if(!responseConfig.success || !searchQueryRes.modelDef)
					{
						console.error("Invalid search query name specified - '" + name + "' got error response as - ");
						console.error(searchQueryRes);
						
						throw "Invalid search query name specified - " + name;
					}
			
					this.context["searchModel"] = searchQueryRes.modelDef;
							
					//proceed with template processing				
					this.processTemplate();
				}
			]);
		</pre-process>
		<content>
			<exe-script var="_tmp">
				
				//caluculate the size for label and field in the search query ui
				var labelSize = 0, fldLblLength = 0;
				var modelDef = context["searchModel"];

				modelDef.fieldMap = {};
				modelDef.extensionFieldMap = {};

				
				for(var i = 0; i &lt; modelDef.fields.length; i++)
				{
					fldLblLength = $.fontWidth('bold 14px "Times New Roman", Times, serif', modelDef.fields[i].label + "M");
					labelSize = (labelSize &gt; fldLblLength) ? labelSize : fldLblLength;

					modelDef.fieldMap[ modelDef.fields[i].name ] = modelDef.fields[i];
				}
				
				context["labelSize"] = labelSize;
				context["fieldWidth"] = 15;
				////////////////////////
				
				//set the actions on context
				var actions = context.element.children("action");
				
				if(actions.length &gt; 0)
				{
					context["actions"] = context.element.children("action");
				}
				else
				{
					context["actions"] = null;
				}
				
				context["export-action"] = true;
				
				if(context.attr("export-action") == 'false')
				{
					context["export-action"] = false;
				}
				
				//check if custom results displayer is present
				var resultCustomizer = context.element.children("result-customizer");
				
				if(resultCustomizer)
				{
					context["resultCustomizer"] = $(resultCustomizer.get(0)).html();
				}
				
				//search field customizers
				var resultFieldCustomizers = context.element.children("result-field-customizer");
				var resultFieldCustomizer = {};
								
				if(resultFieldCustomizers.length &gt; 0)
				{
					var fldCustomizer = null;
					
					for(var i = 0; i &lt; resultFieldCustomizers.length; i++ )
					{
						fldCustomizer = $(resultFieldCustomizers.get(i)); 
						
						resultFieldCustomizer[fldCustomizer.attr("field")] = fldCustomizer.html();
					}
				}
				
				context.$scope.resultFieldCustomizer = resultFieldCustomizer;

				//search field customizers
				var searchFieldCustomizers = context.element.children("search-field-customizer");
				var searchFieldCustomizer = {};
								
				if(searchFieldCustomizers.length &gt; 0)
				{
					var fldCustomizer = null;
					
					for(var i = 0; i &lt; searchFieldCustomizers.length; i++ )
					{
						fldCustomizer = $(searchFieldCustomizers.get(i)); 
						
						searchFieldCustomizer[fldCustomizer.attr("field")] = {
							"hidden" : ("true" == fldCustomizer.attr("hide-field")) ? true : false,
							"defaultValue" : fldCustomizer.attr("default-value")
						};					
					}
				}
				
				context.$scope.searchFieldCustomizer = searchFieldCustomizer;
				context["searchFieldCustomizer"] = searchFieldCustomizer;
			</exe-script>
			
			<set-var name="_showQuery" expr=" (context.attr('hide-query') == 'true') ? false : true"/>
			
			<div id="${attr('id')}" class="container-fluid" style="padding: 0px; margin: 0px" ng-controller="searchQueryController" yk-model-def="${searchModel.name}">
			
				<span style="display: none;" ng-init="searchQueryId = '${attr('id')}'; searchQueryName = '${attr('name')}';"></span>
				
				<if test="context.attr('execute-at-start') == 'true'">
					<span style="display: none;" ng-init="performSearch();"></span>
				</if>
				
				<if test="context._showQuery">
					<div class="panel panel-default" style="margin-bottom: 0.4em;">
						<div class="panel-heading" style="padding: 0.3em 1em; font-weight: bold;">
							${attr('title')}
						</div>
		
						<div class="panel-body model-form" style="padding: 0px;">
							<form>
								<div style="width: 100%; padding: 0px;">
									<for-each data="${searchModel.fields}" loop-var="field" index-var="idx">
										<if test="!context.field.displayable">
											<continue/>
										</if>
										
										<!-- Customizes the field as specified -->
										<if test="context.searchFieldCustomizer &amp;&amp; context.searchFieldCustomizer[context.field.name]">
											<if test="context.searchFieldCustomizer[context.field.name].defaultValue">
												<span style="display: none;" ng-init="defaultValues['${field.name}'] = '${searchFieldCustomizer[context.field.name].defaultValue}';"></span>
											</if>
										
											<if test="context.searchFieldCustomizer[context.field.name].hidden">
												<continue/>
											</if>
										</if>
										
										<yk-model-field id="searchQuery.${field.name}" name="${field.name}" modelobj="searchQuery" 
												label-width="${labelSize}px" field-width="${fieldWidth}em" full-width="" 
												element-style="margin: 1em; margin-bottom: 0px;"></yk-model-field>
									</for-each>
								</div>
								
								<div class="row" style="text-align: right; padding-right: 2em;">
									<!-- Submit button is added to support enter key in search form. This will be hidden.
										Instead iconic link button will be used for click 
									 -->
									<input type="submit" value="Search" style="display: none;" ng-click="performSearch($event)"/>
									
									<a id="${attr('id')}_searchBut" class="btn btn-primary" role="button" ng-click="performSearch()" style="margin: 0.5em; margin-right: 0px;">
										<i class="glyphicon glyphicon-search"></i>
										Search
									</a>
								</div>
							</form>
						</div>
					</div>
				</if>
				
				<div class="row">
					<form name="exportForm" style="diplay: none;">
						<input type="hidden" name="queryModelJson"/>
						<input type="hidden" name="pageSize" value="-1"/>
						<input type="hidden" name="AUTH_TOKEN" value=""/>
					</form>
				
					<if test="context.actions">
						<div class="col-xs-12" style="text-align: right; padding-bottom: 0.4em;">
							<if test="context['export-action']">
								<yk-icon-link icon="fa fa-building" ng-click="exportResults()" 
										color="green" label="Export Excel" ng-show="searchResults.length != 0"></yk-icon-link>
							</if>
							
							<for-each data="${actions}" loop-var="action" index-var="actionIdx">
								<set-var name="_action" expr="$(context.action)"/>
								<set-var name="_label" expr="context._action.attr('label') ? context._action.attr('label') : ''"/>
								<set-var name="_actionId" expr="context._action.attr('id') ? context._action.attr('id') : ''"/>

								<set-var name="_showExpr" 
									expr="(context._action.attr('row-action') == 'true') ? 'selectedIndex != null &amp;&amp; selectedIndex &gt;= 0' : 'true'"/>
								
								<yk-icon-link id="${_actionId}" icon="glyphicon ${_action.attr('icon')}" ng-click="${_action.attr('method')}" 
										color="${_action.attr('color')}" label="${_action.attr('label')}" ng-show="${_showExpr}"></yk-icon-link>
							</for-each>
							
							<div id="${attr('id')}_context_menu">
								<ul class="dropdown-menu" role="menu">
									<for-each data="${actions}" loop-var="action" index-var="actionIdx">
										<set-var name="_action" expr="$(context.action)"/>
										<set-var name="_label" expr="context._action.attr('label') ? context._action.attr('label') : ''"/>
										<set-var name="_showExpr" 
											expr="(context._action.attr('row-action') == 'true') ? 'selectedIndex != null &amp;&amp; selectedIndex &gt;= 0' : 'true'"/>
										
										<li>
											<a tabindex="-1" ng-click="${_action.attr('method')}" 
													style="text-decoration: none; color: black; cursor: default; padding: 0.5em;" ng-show="${_showExpr}">
												<i class="glyphicon ${_action.attr('icon')}" style="color: ${_action.attr('color')}; margin-right: 0.5em;"></i>
												${_action.attr('label')}
											</a>
										</li>
									</for-each>
								</ul>
							</div>
							
						</div>
					</if>
				</div>

				<!-- Popup actions -->	
				<div class="popupIconsContainer popupIcons">
					<if test="context.actions">
						<for-each data="${actions}" loop-var="action" index-var="actionIdx">
							<set-var name="_action" expr="$(context.action)"/>
							<set-var name="_label" expr="context._action.attr('label') ? context._action.attr('label') : ''"/>

							<a role="button" ng-click="${_action.attr('method')}" style="text-decoration: none; color: ${_action.attr('color')};" class="yk-icon-link" 
										data-toggle="tooltip" title="${_action.attr('label')}" >
								<i class="glyphicon ${_action.attr('icon')}"></i>
							</a>
						</for-each>
					</if>
				</div>
				<!-- End of popup actions -->
				
				<yk-dialog id="${attr('id')}_search_settings" title="${attr('title')} Settings">
					<content>
						<span  class="yk-field-label">Page Size:</span> 
						<input type="int" ng-model="searchSettings.pageSize" min="1" max="100" style="min-width: 4em; width: 4em;"/>
						<BR/><BR/>
						 
						<table style="width: 100%;" class="table table-striped table-bordered table-hover">
							<tr>
								<th colspan="3">Columns</th>
							</tr>
							<tr ng-repeat="column in searchSettings.searchColumns" grid-row="{{$index}}">
							
								<td style="padding: 0px; vertical-align: middle; text-align: left; width: 0.2em; padding-right: 1em; padding-left: 1em;">
									<input type="checkbox" ng-model="column.displayed" ng-true-value="true" ng-false-value="false" style="min-width: 1em;"/>
								</td>
								<td style="padding: 0px; vertical-align: middle; text-align: left; width: 0.2em; padding-right: 1em; padding-left: 1em; white-space: nowrap;" class="yk-field-label">
									{{column.label}}
								</td>
								<td style="padding: 0px; vertical-align: middle; text-align: left; width: 0.2em; padding-right: 1em; padding-left: 1em; white-space: nowrap;">
									<yk-icon-link id="${attr('id')}_set_act_${index}" icon="glyphicon glyphicon-arrow-up" ng-click="moveColumnUp($event)" color="blue" label="Up" size="0.8em"></yk-icon-link>
									<yk-icon-link id="${attr('id')}_set_act_${index}" icon="glyphicon glyphicon-open" ng-click="moveColumnToTop($event)" color="blue" label="Top" size="0.8em"></yk-icon-link>
									
									<yk-icon-link id="${attr('id')}_set_act_${index}" icon="glyphicon glyphicon-arrow-down" ng-click="moveColumnDown($event)" color="blue" label="Down" size="0.8em"></yk-icon-link>
									<yk-icon-link id="${attr('id')}_set_act_${index}" icon="glyphicon glyphicon-save" ng-click="moveColumnToBottom($event)" color="blue" label="Bottom" size="0.8em"></yk-icon-link>
								</td>
							</tr>
						</table>
					</content>
					<footer>
						<button type="button" class="btn btn-primary action-button" ng-click="saveSettings()">Save</button>
						<button type="button" class="btn btn-danger cancel-button" data-dismiss="modal">Cancel</button>
					</footer>
				</yk-dialog>

				<if test="!context.resultCustomizer">
					<div id="${attr('id')}_search_results" class="panel panel-default" data-toggle="context" data-target="#${attr('id')}_context_menu">
						<div class="panel-heading" style="padding: 0.3em 1em; font-weight: bold;">
							<table style="width: 100%;">
								<tr>
									<td>${attr('title')} - Results</td>
									<td style="text-align: right;">
										<yk-icon-link id="${attr('id')}_settings" icon="glyphicon glyphicon-cog" ng-click="customizeSettings()" color="blue" label="Settings" size="1.2em"></yk-icon-link>
									</td>
								</tr>
							</table>
						</div>
		
						<div class="panel-body table-responsive"  yk-model="${searchModel.name}" style="padding: 0px;">
							<table class="table table-striped table-bordered table-hover searchResults" ng-if="searchResults.length &gt; 0">
								<!-- Headings row -->
								<tr>
									<th>#</th>
									<th ng-repeat="field in searchResultDef.fields" ng-if="field.displayable">
										{{field.label}}
									</th>
								</tr>
								
								<tr ng-repeat="result in searchResults" ng-click="rowSelected($index, $event)" yk-right-click="rowSelected({{$index}}, $event)" search-row-id="{{$index}}" style="cursor: pointer;">
									<td>{{$index + 1}}</td>
									<td ng-repeat="field in searchResultDef.fields" ng-if="field.displayable">
										<div ng-if="getResultFieldCustomizer()[field.name]" style="display: inline" 
											yk-dynamic="$scope.getResultFieldCustomizer()[$scope.field.name]">
										</div>
										<div ng-if="!getResultFieldCustomizer()[field.name]" style="display: inline">
											{{result[field.name]}}
										</div>
									</td>
								</tr>
							</table>
							<table style="width: 100%;" class="table" ng-if="searchExecuted &amp;&amp; searchResults.length &gt; 0">
								<tr>
									<td style="text-align: left; padding: 0px; padding-left: 1em;">
										<span class="yk-field-label">Matching records: {{recordCount}}</span>
									</td>
									<td style="text-align: right; padding: 0px; padding-right: 1em;">
										<yk-icon-link id="${attr('id')}_prev_page" icon="glyphicon glyphicon-arrow-left" ng-click="gotoPage(-1)" color="blue" label="Previous Page" size="1.5em" ng-if="currentPageNo &gt; 1"></yk-icon-link>
										<span class="yk-field-label">Page: {{currentPageNo}} / {{pageCount}}</span>
										<yk-icon-link id="${attr('id')}_prev_page" icon="glyphicon glyphicon-arrow-right" ng-click="gotoPage(1)" color="blue" label="Next Page" size="1.5em"  ng-if="currentPageNo &lt; pageCount"></yk-icon-link>
									</td>
								</tr>
							</table>
							
							<div ng-if="searchExecuted &amp;&amp; searchResults.length &lt;= 0" style="margin: 0.5em;">No records found for specified criteria.</div>
							<div ng-if="!searchExecuted" style="margin: 0.5em; color: rgb(220, 220, 220);">Search query not executed yet!</div>
						</div>
					</div>
				</if>
				<else>
					${resultCustomizer}
				</else>
				
				<span style="display: none;" ng-init="init()"></span>
			</div>
		</content>
		
		<pre-compile-script>
			context.$result.data('model-def', context["searchModel"]);
		</pre-compile-script>
		
		<post-script>
			context.validator.customizeUi(context.$result, context["searchModel"]);
		</post-script>
	</directive>

	<directive name="ykDialog" required-attr="id, title">
		<content>
			<set-var name="_size" expr="(context.attr('size') == 'small') ? 'modal-sm' : 'modal-lg'"/>
			<set-var name="_content" expr="context.element.find('content').html()"/>
			<set-var name="_footer" expr="context.element.find('footer').html()"/>
			
			<div class="modal fade" id="${attr('id')}" tabindex="-1" role="dialog" data-backdrop="static">
				<div class="modal-dialog ${_size}" role="document">
					<div class="modal-content">
						<if test="context.attr('hide-header') != 'true'">
							<!-- Header -->
							<div class="modal-header app-dlg-header">
								<a title="Close" data-toggle="tooltip" class="yk-icon-link" 
										style="text-decoration: none; color: black; font-size: 0.9em; float: right; cursor: pointer;" 
										data-dismiss="modal" aria-label="Close">
									<i class="glyphicon glyphicon-remove"></i>
								</a>

								<h4 class="modal-title">${attr('title')}</h4>
							</div>
						</if>
						
						<!-- Content -->
						<div class="modal-body">
							${_content}
						</div>
						
						<!-- Footer -->
						<div class="modal-footer" style="padding: 0.5em 1em;">
							${_footer}
						</div>
					</div>
				</div>
			</div>

		</content>
	</directive>

	<directive name="ykModelDialog" required-attr="id, name, columns, title, actionmethod">
		<content>
			<exe-script var="_tmp">
				var extraHtml = context.element.find("extra-content");
				
				if(extraHtml &amp;&amp; extraHtml.length &gt; 0)
				{
					extraHtml = $(extraHtml.get(0)).html();
				}
				else
				{
					extraHtml = "";
				}
				
				context["extraHtml"] = extraHtml; 
				
				context["modelObj"] = context.attr("modelObj") ? context.attr("modelObj") : "model";
				
				var extension = context.attr("extension");
				context["extension"] = (extension &amp;&amp; extension.length &gt; 0) ? extension : "";

				//model field customizers
				var fieldCustomizers = context.element.children("field-customizer");
				context["fieldCustomizers"] = fieldCustomizers;
			</exe-script>
		
			<set-var name="_size" expr="(context.attr('size') == 'small') ? 'modal-sm' : 'modal-lg'"/>
			
			<div class="modal fade" id="${attr('id')}" tabindex="-1" role="dialog" data-backdrop="static">
				<div class="modal-dialog ${_size}" role="document">
					<div class="modal-content">
						<!-- Header -->
						<div class="modal-header app-dlg-header">
							<a title="Close" data-toggle="tooltip" class="yk-icon-link" 
									style="text-decoration: none; color: black; font-size: 0.9em; float: right; cursor: pointer;" 
									data-dismiss="modal" aria-label="Close">
								<i class="glyphicon glyphicon-remove"></i>
							</a>
							<h4 class="modal-title">${attr('title')}</h4>
						</div>
						
						<!-- Content -->
						<div class="modal-body" yk-model="${attr('name')}">
							<yk-model-form name="${attr('name')}" columns="${attr('columns')}" modelObj="${modelObj}" extension="${extension}">
								<for-each data="${fieldCustomizers}" loop-var="customizer" index-var="idx"><![CDATA[
									<field-customizer ${attrStr(context.customizer)}/>
								]]></for-each>
							</yk-model-form>
							
							${extraHtml}
						</div>
						
						<!-- Footer -->
						<div class="modal-footer" style="padding: 0.5em 1em;">
							<button type="button" class="btn btn-primary action-button" ng-click="${attr('actionMethod')}">{{newModelMode ? 'Save' : 'Update'}}</button>
							<button type="button" class="btn btn-danger cancel-button" data-dismiss="modal">Cancel</button>
						</div>
					</div>
				</div>
			</div>

		</content>
	</directive>

	<directive name="ykModelForm" required-attr="name, columns">
		<pre-process>
			context.executeAsyncSteps({"context": context, "processTemplate": processTemplate}, [
			
				//invokes action to fetch model form def			
				function(callback) {
					//invoke the action and fetch model definition
					var modelName = this.context.attr('name');
					var extension = this.context.attr("extension");
					extension = (extension &amp;&amp; extension.length &gt; 0) ? extension : null;
					
					context.modelDefService.getModelDef(modelName, callback, extension);
				},
			
				//validates and sets the model def on context. And invokes action to fetch extension
					// fields if required	
				function(callback, modelDefResponse, responseConfig) {
					var modelName = context.attr('name');
					
					if(!modelDefResponse || !modelDefResponse.modelDef)
					{
						throw "Invalid model name specified - " + modelName;
					}
		
					var modelDef = modelDefResponse.modelDef;
					this.context["modelDef"] = modelDef;
					
					var extension = this.context.attr("extension");
					extension = (extension &amp;&amp; extension.length &gt; 0) ? extension : modelDef.extensionName;

					//invoke the action to fetch model extensions
					if(extension)
					{
						this.context["extension"] = extension;
					}
					
					this.processTemplate();
				},
				
			]);
		</pre-process>

		<content>
			<exe-script var="_tmp">
				var modelDef = context["modelDef"];
	
				//caluculate the size for label and field in the search query ui
				var labelSize = 0, fldLblLength = 0;
				
				for(var i = 0; i &lt; modelDef.fields.length; i++)
				{
					fldLblLength = $.fontWidth('bold 14px "Times New Roman", Times, serif', modelDef.fields[i].label + "MMM");
					labelSize = (labelSize &gt; fldLblLength) ? labelSize : fldLblLength;
				}
				
				var extendedFields = modelDef.extensionFields;
				
				if(!extendedFields)
				{
					extendedFields = [];
				}
				else
				{
					context["extensionFields"] = extendedFields;
				}
				
				//if model is extendable, fetch extension field details
				for(var i = 0; i &lt; extendedFields.length; i++)
				{
					fldLblLength = $.fontWidth('bold 14px "Times New Roman", Times, serif', extendedFields[i].label + "MMM");
					labelSize = (labelSize &gt; fldLblLength) ? labelSize : fldLblLength;

					extendedFields[i].fieldType = extendedFields[i].type;
				}
				
				context["labelSize"] = labelSize;

				var columnCount = parseInt(context.attr('columns'));
				columnCount = (columnCount &gt; 3) ? 3 : columnCount;
				columnCount = (columnCount &lt; 1) ? 1 : columnCount;
				
				context["fullWidth"] = (95 / columnCount);
				context["columnCount"] = columnCount;

				context["colIndex"] = 0;
				context["extColIndex"] = 0;
				
				//get the model object name
				var modelObj = context.attr("modelObj") ? context.attr("modelObj") : "model";
				context["modelObj"] = modelObj;

				context["containerStyle"] = context.attr("style") ? context.attr("style") : ""; 

				//model field customizers
				var fieldCustomizers = context.element.children("field-customizer");
				var fieldCustomizer = {};
								
				if(fieldCustomizers.length &gt; 0)
				{
					var fldCustomizer = null;
					
					for(var i = 0; i &lt; fieldCustomizers.length; i++ )
					{
						fldCustomizer = $(fieldCustomizers.get(i)); 
						
						fieldCustomizer[fldCustomizer.attr("field")] = {
							"hidden" : ("true" == fldCustomizer.attr("hide-field")) ? true : false,
							"defaultValue" : fldCustomizer.attr("default-value")
						};					
					}
				}
				
				context.$scope.fieldCustomizer = fieldCustomizer;
				context["fieldCustomizer"] = fieldCustomizer;
			</exe-script>
			
			<div class="container-fluid model-form" yk-model-def="${modelObj}" style="${containerStyle}">
				<span style="display: none;" ng-init="modelName = '${attr('name')}';"></span>
				
				<div style="width: 100%;">
					<for-each data="${modelDef.fields}" loop-var="field" index-var="idx">
						<if test="!context.field.displayable">
							<continue/>
						</if>
					
						<if test="context.colIndex != 0 &amp;&amp; (context.colIndex % context.columnCount) == 0"><![CDATA[
							</div>
							<div style="${enclosingDivStyle}">
						]]></if>
						
						<!-- Customizes the field as specified -->
						<if test="context.fieldCustomizer &amp;&amp; context.fieldCustomizer[context.field.name]">
							<if test="context.fieldCustomizer[context.field.name].defaultValue">
								<span style="display: none;" ng-init="defaultValues['${field.name}'] = '${fieldCustomizer[context.field.name].defaultValue}';"></span>
							</if>
						
							<if test="context.fieldCustomizer[context.field.name].hidden">
								<continue/>
							</if>
						</if>

						<yk-model-field name="${field.name}" modelobj="${modelObj}" label-width="${labelSize}px" 
							field-width="100%" full-width="${fullWidth}%" 
							element-style="margin: 0px; margin-left: 1em; margin-top: 1em;"></yk-model-field>
						
						<exe-script var="_tmp">
							context["colIndex"]++;
						</exe-script>
						
					</for-each>
				</div>							
				<div style="width: 100%;">
					<for-each data="${extensionFields}" loop-var="field" index-var="idx">
						<if test="context.extColIndex != 0 &amp;&amp; (context.extColIndex % context.columnCount) == 0"><![CDATA[
							</div>
							<div style="width: 100%;">
						]]></if>
						
						<yk-model-field name="${field.name}" modelobj="${modelObj}.extendedFields" label-width="${labelSize}px" 
							field-width="100%" full-width="${fullWidth}%"
							element-style="margin: 0px; margin-left: 1em; margin-top: 1em;" extended="true"></yk-model-field>

						<exe-script var="_tmp">
							context["extColIndex"]++;
						</exe-script>
					</for-each>
				</div>							
			</div>
		</content>

		<pre-compile-script>
			context.$result.data('model-def', context["modelDef"]);
		</pre-compile-script>
		
		<post-script>
			context.validator.customizeUi(context.$result, context["modelDef"]);
		</post-script>
	</directive>

	<attr-directive name="ykModelDef">
		<script>
		</script>
	</attr-directive>

	<directive name="ykModelField" required-attr="name">
		<content>
			<exe-script var="_tmp">
				var modelDef =  context.actualElement.closest('[yk-model-def]').data('model-def');
				var name = context.attr('name');
				var extended = (context.attr('extended') == "true");
				
				if(!modelDef)
				{
					throw "No model-def is defined for yk-model-field with name - " + name;
				}
				
				var fieldDef = extended ? modelDef.extensionFieldMap[name] : modelDef.fieldMap[name];
				
				if(!fieldDef)
				{
					throw "Invalid field name specified under yk-model-field. No field with name '" + name + "' exists under model - " + modelDef.name;
				}
				
				var lovParentField = fieldDef.lovDetails ? fieldDef.lovDetails.parentField : null;
				
				var modelPrefix = context.attr('modelobj');
				
				if(modelPrefix &amp;&amp; modelPrefix.length &gt; 0)
				{
					context["modelField"] = modelPrefix + "." + name;
					
					if(lovParentField)
					{
						lovParentField = modelPrefix + "." + lovParentField;
					}
				}
				else
				{
					context["modelField"] = name;
				}
				
				context["fieldName"] = name;
				context["lovParentField"] = lovParentField ? lovParentField : "";
				
				
				if(extended)
				{
					context["extended"] = "true";
					context["validateFunc"] = "validateExtendedField('" + name + "', '" + modelPrefix + "')";
					context["fieldLabel"] = "%" + fieldDef.name;
				}
				else
				{
					context["validateFunc"] = "validateField('" + name + "', '" + modelPrefix + "')";
					context["fieldLabel"] = fieldDef.name;
				}
				
				context["fieldDef"] = fieldDef;
				context["modelDef"] = modelDef;
			</exe-script>
			
			<div style="display: inline-block; vertical-align: top; width: ${element.attr('full-width')}; ${element.attr('element-style')}" model-field-div="${modelField}">
				<table style="width: 100%;border-collapse: collapse;border-spacing: 0px;">
					<tr>
						<td style="vertical-align: top; padding: 0px; width: ${element.attr('label-width')}; min-width: ${element.attr('label-width')}; " 
								yk-hide-from="xs" class="yk-field-label" field-label="${fieldLabel}">
							${fieldDef.label}
						</td>
						<td style="padding: 0px;">
							<div class="visible-xs-block yk-field-label" field-label="${fieldLabel}" style="font-size: 0.8em;">
								${fieldDef.label}
							</div>
							<div style="width: ${element.attr('field-width')}; display: inline-block; padding: 0px;">
								<if test="context.fieldDef.fieldType == 'STRING'">
									<input type="text" name="${fieldDef.name}" placeholder="${fieldDef.label}" 
										ng-model="${modelField}" yk-read-only="${fieldDef.readOnly}" ng-change="${validateFunc}"></input>
								</if>
								<else-if test="context.fieldDef.fieldType == 'COLOR'">
									<yk-color-field name="${fieldDef.name}" ng-model="${modelField}" placeholder="${fieldDef.label}"
										yk-read-only="${fieldDef.readOnly}" ng-change="${validateFunc}"/>
								</else-if>
								<else-if test="context.fieldDef.fieldType == 'MULTI_LINE_STRING'">
									<textarea name="${fieldDef.name}" placeholder="${fieldDef.label}" ng-model="${modelField}" 
											yk-read-only="${fieldDef.readOnly}" style="height: 4em;" ng-change="${validateFunc}"></textarea>
								</else-if>
								<else-if test="context.fieldDef.fieldType == 'PASSWORD'">
									<input type="password" name="${fieldDef.name}" placeholder="${fieldDef.label}" ng-model="${modelField}"  
										yk-read-only="${fieldDef.readOnly}" ng-change="${validateFunc}"></input>
								</else-if>
								<else-if test="context.fieldDef.fieldType == 'INTEGER'">
									<input type="number" name="${fieldDef.name}" placeholder="${fieldDef.label}" ng-model="${modelField}"  
										yk-read-only="${fieldDef.readOnly}" ng-change="${validateFunc}"></input>
								</else-if>
								<else-if test="context.fieldDef.fieldType == 'FLOAT' || context.fieldDef.fieldType == 'DECIMAL'">
									<input type="number" name="${fieldDef.name}" placeholder="${fieldDef.label}" ng-model="${modelField}"  
										yk-read-only="${fieldDef.readOnly}" ng-change="${validateFunc}" step="any"></input>
								</else-if>
								<else-if test="context.fieldDef.fieldType == 'BOOLEAN'">
									<exe-script var="_tmp">
										if(!context.$scope.dropDownBoolean)
										{
											context.$scope.dropDownBoolean = [{"value": true, "label": "True"}, {"value": false, "label": "False"}];
										}
									</exe-script>
			
									<select name="${fieldDef.name}" ng-model="${modelField}"  yk-read-only="${fieldDef.readOnly}" ng-change="${validateFunc}"
											ng-options="item.value as item.label for item in dropDownBoolean">
										<option value="" selected=""> -- Select ${fieldDef.label} -- </option>
									</select>
								</else-if>
								<else-if test="context.fieldDef.fieldType == 'DATE'">
									<yk-date-field name="${fieldDef.name}" label="${fieldDef.label}" ng-model="${modelField}"
										yk-read-only="${fieldDef.readOnly}" ng-change="${validateFunc}"></yk-date-field>
								</else-if>
								<else-if test="context.fieldDef.fieldType == 'LIST_OF_VALUES'">
									<if test="context.extended == 'true'">
										<select name="${fieldDef.name}" ng-model="${modelField}"  yk-read-only="${fieldDef.readOnly}" ng-change="${validateFunc}">
											<option value="" selected=""> -- Select ${fieldDef.label} -- </option>
			
											<for-each data="${fieldDef.lovOptions}" loop-var="lovOption" index-var="idx">
												<option value="${lovOption.value}">${lovOption.label}</option>
											</for-each>
										</select>
									</if>
									<else>
										<yk-lov-field name="${fieldDef.name}" label="${fieldDef.label}" lov="${fieldDef.lovDetails.lovName}" yk-read-only="${fieldDef.readOnly}"
													type="${fieldDef.lovDetails.lovType}" model="${modelField}" on-change="${validateFunc}"
													actual-type="${fieldDef.lovDetails.actualType}" multi-valued="${fieldDef.multiValued}" parent-field="${lovParentField}"></yk-lov-field>
									</else> 
								</else-if>
								<else-if test="context.fieldDef.fieldType == 'FILE'">
									<if test="context.fieldDef.multiValued == false">
										<div style="width: ${attr('width')};padding: 0px;border: solid 1px rgb(200, 200, 200); border-radius: 0.4em;" yk-file="true">
											<table style="width: 100%; table-layout: fixed;">
												<tr>
													<td style="padding: 0.2em; overflow: hidden; white-space: nowrap;">
														<div ng-show="${modelField}">
															<a role="button" yk-file-delete="-1" model-name="${modelField}"
																		data-toggle="tooltip" title="Remove" class="delButtonLink">
																<span aria-hidden="true">&amp;times;</span>
															</a>
															<!-- Span when file info comes from server -->
															<span ng-show="${modelField}.fileName" style="cursor: default;" data-toggle="tooltip" title="{{${modelField}.fileName}}">
																<a href="#" yk-file-link="{{${modelField}.id}}" style="font-weight: bold;"> 
																	{{${modelField}.fileName}}
																</a>
															</span>
															<!-- Span when user adds a file -->
															<span ng-show="${modelField}.name" style="cursor: default;" data-toggle="tooltip" title="{{${modelField}.name}}">
																{{${modelField}.name}}
															</span>
														</div>
														<!-- Span for place holder -->
														<span ng-hide="${modelField}" style="color: rgb(200, 200, 200); margin-left: 0.5em;">
															${fieldDef.label}
														</span>
													</td>
													<td style="width: 2px;padding: 0px;">
														<button type="button" class="btn btn-primary action-button fileProxy" yk-read-only="${fieldDef.readOnly}" style="padding: 0.3em;">...</button>
														<input type="file" name="${fieldDef.name}" ng-model="${modelField}" style="display: none;"></input>										
													</td>
												</tr>
											</table>
										</div>
									</if>
									<else>
										<div style="width: ${attr('width')}; padding: 0px;border: solid 1px rgb(200, 200, 200); border-radius: 0.4em;" yk-file="true">
											<!-- Title bar -->
											<div style="width: 100%;border-bottom: solid 1px rgb(200, 200, 200); padding: 0px; font-size: 0.8em;">
												<table style="width: 100%">
													<tr>
														<td style="text-align: left; color: rgb(200, 200, 200); padding-left: 0.2em;">
															${fieldDef.label}
														</td>
														<td style="text-align: right;">
															<button type="button" class="btn btn-primary action-button fileProxy" 
																yk-read-only="${fieldDef.readOnly}" style="padding: 0.3em; font-size: 0.8em;">...</button>
															<input type="file" name="${fieldDef.name}" ng-model="${modelField}" style="display: none;" multiple="multiple"></input>										
														</td>
													</tr>
												</table>
											</div>
											<!-- File contents -->
											<div style="overflow: auto; height: 4em;">
												<div ng-repeat="file in ${modelField}" style="white-space: nowrap; padding: 0px; margin: 0px; font-size: 0.8em;">
													<a role="button" class="delButtonLink" yk-file-delete="{{$index}}" model-name="${modelField}"  
																data-toggle="tooltip" title="Remove" file-index="{{$index}}">
														<span aria-hidden="true" style="color: red;">&amp;times;</span>
													</a>
													<!-- Span when file info comes from server -->
													<span ng-show="file.fileName" style="cursor: default;" data-toggle="tooltip" title="{{file.fileName}}">
														<a href="#"  yk-file-link="{{file.id}}"  style="font-weight: bold;"> 
															{{file.fileName}}
														</a>
													</span>
													<!-- Span when user adds a file -->
													<span ng-show="file.name" style="cursor: default;" data-toggle="tooltip" title="{{file.name}}">
														{{file.name}}
													</span>
												</div>
											</div>
										</div>
									</else>
								</else-if>
								<else-if test="context.fieldDef.fieldType == 'IMAGE'">
									<yk-image-field width="8em" height="8em" name="${fieldDef.name}" 
										label="${fieldDef.label}" model="${modelField}" on-change="${validateFunc}"></yk-image-field>
								</else-if>
								<else>
									<exe-script var="_tmp1">
										throw "Unsupported field type encountered - " + context.fieldDef.fieldType;
									</exe-script>
								</else>
							</div>
							<div class="yk-field-error" ng-bind="errors.${modelField}">
							</div>
						</td>
					</tr>
				</table>
			</div>
		</content>
	</directive>
	
	<directive name="ykLovField" required-attr="name, label, lov, type">
		<pre-process>
			context.executeAsyncSteps({"context": context, "processTemplate": processTemplate}, [
			
				//invokes action to fetch search query definition			
				function(callback) {
					var modelDef = this.context["$scope"].modelDef;
					var lovName = this.context.attr('lov');
					var type = this.context.attr('type');
					var model = this.context.attr('model');
				

					var parentField = this.context.attr('parent-field');
					parentField = (parentField &amp;&amp; parentField.length &gt; 0) ? parentField : null;
					
					if(model &amp;&amp; model.length &gt;= 0)
					{
						this.context["modelField"] = model;
					}
					else
					{
						this.context["modelField"] = context.attr('name');
					}
					
					type = (type == "static" || type == "STATIC_TYPE")? "STATIC_TYPE" : "DYNAMIC_TYPE";
					
					context.parentField = parentField;
					
					//if this is dependency lov, dont make any call to server
						// and assume empty data by default
					if(parentField != null)
					{
						callback({"lovList": []}, {"success" : true});
						return;
					}
					
					context.invokeAction('lov.fetch', null, {"name": lovName, "type": type}, callback);
				},
			
				//validates and sets the query def on context and proceeds with template processing	
				function(callback, lovRes, responseConfig) {
					var lovName = this.context.attr('lov');
					
					if(!responseConfig.success || !lovRes.lovList)
					{
						this.context.logger.error("Invalid lov name specified - " + lovName);
						this.context.logger.error(lovRes);
						
						throw "Invalid lov name specified - " + lovName;
					}
			
					var lovList = lovRes.lovList;
					context["lovList"] = lovList;
			
					//proceed with template processing				
					this.processTemplate();
				}
			]);
		</pre-process>
		<content>
			<exe-script var="_tmp">
				if(!context.$scope.dropDown)
				{
					context.$scope.dropDown = {};
				}
				
				var lovList = context.lovList;
				
				if(context.attr('actual-type') == 'INTEGER')
				{
					for(var i = 0; i &lt; lovList.length; i++)
					{
						lovList[i].value = parseInt(lovList[i].value);
					}
				}
				
				context.$scope.dropDown[context.attr('name')] = lovList;
				
				//check and set if this field is multi valued lov
				context.multiValued = (context.attr("multi-valued") == 'true') ? true : false;
			</exe-script>
			
			<set-var name="_readOnly" expr="(context.attr('yk-read-only') == 'true') ? 'true' : 'false'"/>
			<set-var name="_actualType" expr="context.attr('actual-type')"/>

			<if test="context.multiValued">
				<div style="width: 100%; padding: 0.3em;border: solid 1px rgb(200, 200, 200); border-radius: 0.4em; overflow: auto; height: 7em;">
					<table>
						<tr ng-repeat="lov in dropDown.${attr('name')}">
							<td>
								<input type="checkbox" value="{{lov.value}}" style="min-width: 1px; height: 1em; width: 1em; margin: 0.2em;"/> 
								{{lov.label}}
							</td>
						</tr>
					</table>
				</div>
			</if>
			<else>
				<select name="${attr('name')}"  ng-model="${modelField}" yk-read-only="${_readOnly}" ng-change="${attr('on-change')}" 
						ng-options="item.value as item.label for item in dropDown.${attr('name')}">
					<option value="" selected=""> -- Select ${attr('label')} --  </option>
				</select>
			</else>
		</content>

		<post-script>
			//if this is a dependency lov			
			if(context.parentField != null)
			{
				//add watch function on parent field
				var watchFunc = $.proxy(function(){
					var value = null;
					
					//during first time model may not be present
					try
					{
						value = eval("this.$scope." + this.parentField);
					}catch(ex)
					{}
					
					return value;
				}, {"$scope" : context.$scope, "parentField": context.parentField});
				
				var respFunc = $.proxy(function(newValue, oldValue){
					if(!newValue)
					{
						this.$scope.dropDown[this.name] = [];
						return;
					}
					
					this.actionHelper.invokeAction('lov.fetchDependentLov', null, {"name": this.lovName, "value": newValue}, $.proxy(function(lovRes, responseConfig){
						if(lovRes &amp;&amp; lovRes.lovList)
						{
							this.$scope.dropDown[this.name] = lovRes.lovList;
						}
						else
						{
							this.$scope.dropDown[this.name] = [];
						}
						
						try
						{
							this.$scope.$digest();
						}catch(ex)
						{}
						
					}, this));
				}, {"$scope" : context.$scope, "actionHelper": context.actionHelper, "name": context.attr('name'), "lovName": context.attr('lov')});
				
				context.$scope.$watch(watchFunc, respFunc);
			}
			
			var multiValued = (context.attr("multi-valued") == 'true') ? true : false;
			
			//for single values lov nothing needs to be done
			if(!multiValued)
			{
				return;
			}
			
			var lovCheckBoxes = $(context.$result).find("input[type='checkbox']");
			
			lovCheckBoxes.off("click").on("click", $.proxy(function(event){
				var lst = [];
				
				for(var i = 0; i &lt; this.lovCheckBoxes.length; i++)
				{
					//if checkbox is checked add the value to final result
					if( $(this.lovCheckBoxes[i]).prop("checked") )
					{
						lst.push( $(this.lovCheckBoxes[i]).val() );
					}
				}
				
				//set the value on the scope
				eval("this.$scope." + this.modelField + " = lst");
				
				//invoke on change method if any
				if(this.onChange &amp;&amp; this.onChange.length &gt; 0)
				{
					var $event = $(event);
					eval("this.$scope." + this.onChange );
				}
				
			}, {"lovCheckBoxes": lovCheckBoxes, "$scope" : context.$scope, "onChange": context.attr('on-change'), "modelField": context.modelField}));

			//Add watch function for lov field			
			var watchFunc = $.proxy(function(){
				//get the model field values
				var values = null;
				
				//during first time model may not be present
				try
				{
					values = eval("this.$scope." + this.modelField);
				}catch(ex)
				{}
				
				if(!values)
				{
					values = [];
				}
				
				//loop through the check boxes and check the checkboxes whose value is present
					// in model field values. If not uncheck.
				for(var i = 0; i &lt; this.lovCheckBoxes.length; i++)
				{
					if(values.indexOf( $(this.lovCheckBoxes[i]).val() ) &gt;= 0 )
					{
						$(this.lovCheckBoxes[i]).prop("checked", true);
					}
					else
					{
						$(this.lovCheckBoxes[i]).prop("checked", false);
					}
				}
				
				return false;
				
			}, {"$scope" : context.$scope, "modelField": context.modelField, "lovCheckBoxes": lovCheckBoxes});
			
			var respFunc = $.proxy(function(newValue, oldValue){
			}, {"$scope" : context.$scope, "element": context.element});
			
			context.$scope.$watch(watchFunc, respFunc);
			
		</post-script>
	</directive>

	<directive name="ykInvoke" required-attr="method">
		<post-script>
			var methodName = context.attr('method');
			context.$scope[methodName]();
		</post-script>
	</directive>

	<directive name="ykIconLink" required-attr="icon, ng-click, color, label">
		<content>
			<set-var name="_showExpr" 
				expr="context.attr('ng-show')? context.attr('ng-show') : 'true'"/>
			<set-var name="_ifExpr" 
				expr="context.attr('ng-if')? context.attr('ng-if') : 'true'"/>
			<set-var name="_sizeAttr" 
				expr="context.attr('size')? 'font-size: ' + context.attr('size') + ';' : '' "/>
			<set-var name="_extraStyle" 
				expr="context.attr('style')? context.attr('style') : '' "/>

			<a id="${attr('id')}" role="button" ng-click="${attr('ng-click')}" style="text-decoration: none; color: ${attr('color')};${_sizeAttr};${_extraStyle}" class="yk-icon-link" 
						data-toggle="tooltip" title="${attr('label')}" ng-show="${_showExpr}" ng-if="${_ifExpr}">
				<i class="${attr('icon')}"></i>
			</a>
		</content>
	</directive>

	<directive name="ykDateField" required-attr="name, label, ng-model">
		<content>
			<set-var name="_readOnly" 
				expr="context.attr('yk-read-only')? context.attr('yk-read-only') : 'false'"/>
			<set-var name="_onChange" 
				expr="context.attr('ng-change')? context.attr('ng-change') : ''"/>

			<div class="form-group" style="margin-bottom: 0px;">
				<div class="model-form-date input-group date">
					<input type="text" class="form-control" name="${attr('name')}" placeholder="${attr('label')}" 
						ng-model="${attr('ng-model')}" yk-read-only="${_readOnly}" ng-change="${_onChange}"></input>
					<span class="input-group-addon">
						<span class="glyphicon glyphicon-calendar"></span>
					</span>
				</div>
			</div>								
		</content>

		<post-script>
			var dateFormat = context.$scope.activeUser.jsDateFormat;
			var element = $(context.$result).find("div.date");
			element = $(element);
			
			element.datetimepicker({
				"format" : dateFormat
			});
			
			element.off("dp.change").on("dp.change", $.proxy(function(event){
				this.element.find("input").trigger("change");
			}, {"element": element, "$scope" : context.$scope}));
		</post-script>
	</directive>
	
	<directive name="ykColorField" required-attr="name, ng-model">
		<content>
			<set-var name="_readOnly" 
				expr="context.attr('yk-read-only')? context.attr('yk-read-only') : 'false'"/>
			<set-var name="_onChange" 
				expr="context.attr('ng-change')? context.attr('ng-change') : ''"/>
			<set-var name="_placeholder" 
				expr="context.attr('placeholder')? context.attr('placeholder') : ''"/>

			<div class="form-group" style="margin-bottom: 0px;">
				<div class="input-group colorpicker-component" style="width: 10em;">
					<input readonly="readonly" type="text" class="form-control" name="${attr('name')}" placeholder="${_placeholder}" 
						ng-model="${attr('ng-model')}" yk-read-only="${_readOnly}" ng-change="${_onChange}">
					</input>
					<span class="input-group-addon"><i></i></span>
				</div>
			</div>
		</content>

		<post-script>
			var element = $(context.$result).find("div.colorpicker-component");
			element = $(element);
			
			element.colorpicker({format: 'hex'});
			
			<!-- event handler for color change -->
			var eventHandler = $.proxy(function(event){	
			
				var colorVal =  $(this.element.find("input")).val();
				
				try
				{
					eval("this.$scope." + this.field + "=colorVal");
				}catch(ex)
				{}
				
			}, {"element": element, 
				"$scope" : context.$scope, 
				"field": context.attr('ng-model')
			});
			
			element.on('changeColor', eventHandler);
			
			<!-- disable the color picker -->
			if(context.attr('yk-read-only') == 'true')
			{
				element.colorpicker('disable');
			}
			
			<!-- watch function -->
			var watchFun = $.proxy(function(){
			
				var strModel = this.field;
				var field = null;
				
				try
				{
					eval("field=this.$scope."+ strModel);
				}catch(ex)
				{}
				
				if(!field)
				{
					this.element.colorpicker("setValue", false);
				}
				
				return field;
				
			},{"element" : element,
				"$scope" : context.$scope,
				"field"	 : context.attr('ng-model')
			});
			
			<!-- Response function -->
			var respFun = $.proxy(function(newVal, oldVal){
			
				var strModel = this.field;
				var colorVal =  $(this.element.find("input")).val();
				
				try
				{
					eval("field=this.$scope." + strModel);
				}catch(ex)
				{
					return;
				}
				
				this.element.colorpicker("setValue", colorVal);
				
			},{"element" : element,
				"$scope" : context.$scope,
				"field"  : context.attr('ng-model')
			});
			
			context.$scope.$watch(watchFun, respFun);
			
		</post-script>
	</directive>
	
	<directive name="ykMarquee" required-attr="id, width, height">
		<content>
			<set-var name="_content" expr="context.bodyAsHtml()"/>

			<div id="${attr('id')}" style="width: ${attr('width')}; height: ${attr('height')};">
				<div style="position: absolute;width: ${attr('width')}; height: ${attr('height')}; overflow: hidden;">
					<div class="contentElem" style="position: absolute; width: 98%;">
						${_content}
					</div>
				</div>
			</div>
		</content>
		<post-script>
			$.marquee(context.attr("id"), context.attr('speed'));
		</post-script>
	</directive>

	<directive name="ykImageField" required-attr="width, height">
		<exe-script>
			var modelPrefix = context.attr('model');
			var field = context.attr('name');
			
			if(modelPrefix &amp;&amp; modelPrefix.length &gt; 0)
			{
				field = modelPrefix + "." + field;
			}
			
			context.imageField = field;
		</exe-script>
		<content>
			<div>
				<div name="${attr('name')}" style="width: ${attr('width')}; height: ${attr('height')}; background-image: url({{getFieldImageUrl('${attr('model')}')}})" 
					class="yk-background-cover yk-image-field imgdiv">
					<div class="yk-image-field-mssg" ng-show="${attr('model')} == null">
						Upload Image<br/>
						(Click here)
					</div>
				</div>
				<input type="file" style="display: none;"/>
			</div>
		</content>
		<post-script>
			var element = $(context.$result);
			$.imageField(element, context.$scope, context.attr('model'), context.actionHelper);
		</post-script>
	</directive>

	<attr-directive name="ykHideFrom">
		<script>
			var hideFrom = context.attributeValue;
            var curCssClasses = context.element.attr("class");

            //if no classes are defined
            if (!curCssClasses)
            {
	            curCssClasses = "";
            }

            if (hideFrom == "xs")
            {
	            curCssClasses += " hidden-xs";
            } else if (hideFrom == "sm")
            {
	            curCssClasses += " hidden-xs hidden-sm";
            } else if (hideFrom == "md")
            {
	            curCssClasses += " hidden-xs hidden-sm hidden-md";
            } else
            {
	            console.error("Invalid yk-hide-from value specified - " + hideFrom);
	            return;
            }

            context.element.attr("class", curCssClasses);
		</script>
	</attr-directive>

	<!--
		Adds ng-repeat with same expression as this attribute value. In some cases ng-repeat may get compiled into a comment which 
		may get removed during directive processing. In order to retain ng-repeat this attribute directive can be used  
	 -->
	 <!--  
	<attr-directive name="ykRepeat">
		<script>
			var repeatExpr = context.attributeValue;
			context.element.attr("ng-repeat", repeatExpr);
		</script>
	</attr-directive>

	<attr-directive name="ykRepeatStart">
		<script>
			var repeatExpr = context.attributeValue;
			context.element.attr("ng-repeat-start", repeatExpr);
		</script>
	</attr-directive>

	<attr-directive name="ykIf">
		<script>
			var repeatExpr = context.attributeValue;
			context.element.attr("ng-if", repeatExpr);
		</script>
	</attr-directive>

	<attr-directive name="ykClick">
		<script>
			var repeatExpr = context.attributeValue;
			context.element.attr("ng-click", repeatExpr);
		</script>
	</attr-directive>

	<attr-directive name="ykRepeatEnd">
		<script>
			var repeatExpr = context.attributeValue;
			context.element.attr("ng-repeat-end", "");
		</script>
	</attr-directive>

	<attr-directive name="ykShow">
		<script>
			var showExpr = context.attributeValue;
			context.element.attr("ng-show", showExpr);
		</script>
	</attr-directive>

	<attr-directive name="ykBind">
		<script>
			var bindExpr = context.attributeValue;
			context.element.attr("ng-bind", bindExpr);
		</script>
	</attr-directive>
	-->
	
	<!--
		Used to inject dynamic html 
	 -->
	<attr-directive name="ykDynamic">
		<script>
		var $scope = context.$scope;
		var innerHtml = eval(context.attributeValue);
		
		innerHtml = context.$compile(innerHtml)($scope);
		
		context.element.html("");
		context.element.append(innerHtml);
		</script>
	</attr-directive>

	<!--
		Invokes the date-time-picker data function on target element
		with specified date format value 
	<attr-directive name="ykDateFormat">
		<script>
			var dateFormat = context.attributeValue;
			context.element.datetimepicker({
				"format" : dateFormat
			});
			
			context.element.off("dp.change").on("dp.change", $.proxy(function(event){
				this.element.find("input").trigger("change");
			}, {"element": context.element, "$scope" : context.$scope}));
		</script>
	</attr-directive>
	-->
	<!--
		Expected to be used as part of file widget. This is used on file's individual remove
		button. And deletes the corresponding file 
	 -->
	<attr-directive name="ykFileDelete">
		<script>
			var fileRemoveButton = context.element;
			var modelName = context.attr('model-name');
			
			$(fileRemoveButton).off("click").on("click", $.proxy(function(event){
				var index = parseInt(this.element.attr("yk-file-delete"));

				//if this button is for single file widget
				if(index &lt; 0)
				{
					eval("this.$scope." + this.modelName + " = null");
					this.$scope.$digest();
				}
				//for multi file widget
				else
				{
					//remove current element
					var files = eval("this.$scope." + this.modelName);
					files.splice(index, 1);
					
					eval("this.$scope." + this.modelName + " = files");
					this.$scope.$parent.$digest();
				}
				
			}, {"element": fileRemoveButton, "$scope" : context.$scope, "modelName": modelName}));
		</script>
	</attr-directive>

	<!-- Used by file widget to display content of the file whose details are obtained from
		server. 
	 -->
	<attr-directive name="ykFileLink">
		<script>
			var fileLink = context.element;
			
			$(fileLink).off("click").on("click", $.proxy(function(event){
				var fileId = parseInt(this.element.attr("yk-file-link"));
				
				if(fileId &lt; 0)
				{
					return;
				}
				
				this.element.get(0).href = this.actionHelper.actionUrl("files.fetch.attachment", {"id": fileId});
			}, {"element": fileLink, "$scope" : context.$scope, "actionHelper": context.actionHelper}));
		</script>
	</attr-directive>

	<attr-directive name="ykFile">
		<script>
			var fileElem = context.element.find("input[type='file']").get(0);
			fileElem = $(fileElem);
			
			//get file proxy button and register event such that when proxy button is clicked
			//		file button click is triggered
			var fileElemProxy = context.element.find("button.fileProxy").get(0);
			$(fileElemProxy).off("click").on("click", $.proxy(function(){
				this.fileElement.trigger("click");
			}, {"fileElement" : fileElem}));
			
			//get name of file element
			var name = fileElem.attr('name');

			//get ng-model name
			var modelName = fileElem.attr("ng-model");
			modelName = (!modelName || modelName.length == 0) ? name : modelName;

			var isMultiple = (fileElem.attr('multiple') == 'multiple');
			
			var eventContent = {
				"$scope" : context.$scope,
				"element": fileElem,
				"modelName": modelName,
				"isMultiple": isMultiple
			};
			
			//add event, such that when file selection is done, the files are added to model
			fileElem.off("change").on('change', $.proxy(function(){
				var fileElem = this.element.get(0);
				var files = fileElem.files;
				
				//if no files are selected return
				if(!files || files.length == 0)
				{
					return;
				}
				
				//if field is expected to hold multiple files, append the new files to the end existing value list
				if(this.isMultiple)
				{
					var currentModelValue = eval("this.$scope." + this.modelName);
					
					if(!currentModelValue)
					{
						currentModelValue = [];
					}
					
					for(var i = 0; i &lt; files.length; i++)
					{
						currentModelValue[currentModelValue.length] = files[i];
					}
					
					eval("this.$scope." + this.modelName + " = currentModelValue");
				}
				//if single file is expected replace current value with new file 
				else
				{
					eval("this.$scope." + this.modelName + " = files[0]");
				}
				
				this.$scope.$digest();
			}, eventContent));
		</script>
	</attr-directive>

	<attr-directive name="ykFileLink">
		<script>
			//get ng-model name
			var modelName = context.attributeValue;

			var fileLink = context.element;
			
			$(fileLink).off("click").on("click", $.proxy(function(){
				var fileId = eval("this.$scope." + this.modelName + ".id");
				this.element.href = this.actionHelper.actionUrl("files.fetch.attachment", {"id": fileId});
			}, {"element": fileLink, "$scope" : context.$scope, "actionHelper" : context.actionHelper, "modelName": modelName}));
		</script>
	</attr-directive>
	
	<attr-directive name="ykOnDrag">
		<script>
			var funName = context.attributeValue;
			
			var element = context.element;
			
			$(element).off("dragstart").on("dragstart", $.proxy(function(event){
				eval("this.$scope." + this.funName);
				
			},{"$scope" : context.$scope, "funName" : funName}));
		</script>
	</attr-directive>
	
	<attr-directive name="ykOnDrop">
		<script>
			var funName = context.attributeValue;
			
			var element = context.element;
			
			$(element).off("drop").on("drop", $.proxy(function(event){
				eval("this.$scope." + this.funName);
				
			},{"$scope" : context.$scope, "funName" : funName}));
		</script>
	</attr-directive>
	
	<attr-directive name="ykOnDragOver">
		<script>
			var funName = context.attributeValue;
			
			var element = context.element;
			
			$(element).off("dragover").on("dragover", $.proxy(function(event){
				eval("this.$scope." + this.funName);
				
			},{"$scope" : context.$scope, "funName" : funName}));
		</script>
	</attr-directive>
	
	<attr-directive name="ykFullHeight">
		<script>
		
			var viewportHeight;
			var viewportWidth;
			
			if (document.compatMode === 'BackCompat') 
			{
			    viewportHeight = document.body.clientHeight;
			    viewportWidth = document.body.clientWidth;
			} 
			else 
			{
			    viewportHeight = document.documentElement.clientHeight;
			    viewportWidth = document.documentElement.clientWidth;
			}
		
		
			var attrVal = context.attributeValue;
			var top = context.element.offset().top;
			var docHeight = 0;
			
			if(attrVal == 'document')
			{
				docHeight = viewportHeight;
			}
			else
			{
				docHeight = $(context.element.parent()).height();
			}
			
			var currentStyle = context.element.attr("style");
			
			if(currentStyle &amp;&amp; currentStyle.length > 0)
			{
				currentStyle += ";";
			}
			else
			{
				currentStyle = "";
			}
			
			context.element.attr("style",  currentStyle + "height : " + (docHeight - top) + "px;");
		</script>
	</attr-directive>

	<attr-directive name="ykRightClick">
		<script>
			var targetElem = context.element;
			
			$(targetElem).off("mousedown").on("mousedown", $.proxy(function(e){

				if( e.button != 2 ) 
				{
					return;
				}
				
				var expr = this.element.attr("yk-right-click");
				var $event = e;
				eval("this.$scope." + expr);
			}, {"element": targetElem, "$scope" : context.$scope, "actionHelper" : context.actionHelper}));
		</script>
	</attr-directive>

	<!--
		If a non-zero value is specified, checks if the current user has target role. If not, 
		target element will be marked with display = none style (which results in hiding parent element) 
	 -->
	<attr-directive name="ykForRole">
		<script>
			var attrVal = context.attributeValue;
			
			if(!attrVal || attrVal.length == 0)
			{
				return;
			}
			
			var watchFunc = $.proxy(function(){
				var roles = this.role.split(/\s*\,\s*/);

				for(var i = 0; i &lt; roles.length; i++)
				{
					if(this.$scope.hasRole(roles[i]))
					{
						return true;
					}
				}
				
				return false;
			}, {"$scope" : context.$scope, "role": attrVal});
			
			var respFunc = $.proxy(function(newValue, oldValue){
				if(!newValue)
				{
					this.element.css("display", "none");
				}
			}, {"$scope" : context.$scope, "element": context.element});
			
			context.$scope.$watch(watchFunc, respFunc);
		</script>
	</attr-directive>
</directives>